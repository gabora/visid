%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% This is the main file of the AMIGO implementation of benchmark B4     
%
% - To change the optimization settings, edit lines 506-511, where the
% optimizer (default: eSS), local solver (default: fmincon), and maximum
% number of function evaluations and CPU time are set.
%
% - If you want to modify the parameter bounds and initial guess, modify
% lines 494-496. Note that when comparing optimization methods these 
% settings must be equal for all methods, to avoid unfair comparisons.
%
% - For further modifications please refer to the AMIGO manual and the
% benchmarks documentation.
%
% CHANGES:
%   - CVODES instead of Fortran radau
%       (convention of double: 'D'-> 'e', ivpsol, sensol,charmodelC)
%   - removed s1 stimuli, not used.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% record random seed:
inputs.randstate = sum(100*clock);
rand('state',inputs.randstate);
randn('state',inputs.randstate);

%=======================
% PATHS RELATED DATA
%=======================

results.pathd.results_folder = 'b4';  % Folder to keep results (in Results) for a given problem          
results.pathd.short_name     = 'b4';  % To identify figures and reports for a given problem   

%========================
% MODEL RELATED DATA
%========================
inputs.model.AMIGOjac = 1;
inputs.model.AMIGOsensrhs = 1;
inputs.model.input_model_type  = 'charmodelC';   % Model introduction: 'charmodelF'|'charmodelM'
inputs.model.n_st              = 35;             % Number of states      
inputs.model.n_par             = 117;            % Number of model parameters 
inputs.model.n_stimulus        = 0;              % Number of inputs, stimuli or control variables 
% inputs.model.stimulus_names	   = char('s1'); % (prov)
inputs.model.st_names		   = char(...
'x1','x2','x3','x4','x5','x6','x7','x8','x9','x10','x11','x12','x13',...
'x14','x15','x16','x17','x18','x19','x20','x21','x22','x23','x24','x25',...
'x26','x27','x28','x29','x30','x31','x32','x33','x34','x35');
inputs.model.par_names			= char(...
'par1','par2','par3','par4','par5','par6','par7','par8','par9','par10',...
'par11','par12','par13','par14','par15','par16','par17','par18','par19',...
'par20','par21','par22','par23','par24','par25','par26','par27','par28',...
'par29','par30','par31','par32','par33','par34','par35','par36','par37',...
'par38','par39','par40','par41','par42','par43','par44','par45','par46',...
'par47','par48','par49','par50','par51','par52','par53','par54','par55',...
'par56','par57','par58','par59','par60','par61','par62','par63','par64',...
'par65','par66','par67','par68','par69','par70','par71','par72','par73',...
'par74','par75','par76','par77','par78','par79','par80','par81','par82',...
'par83','par84','par85','par86','par87','par88','par89','par90','par91',...
'par92','par93','par94','par95','par96','par97','par98','par99','par100',...
'par101','par102','par103','par104','par105','par106','par107','par108',...
'par109','par110','par111','par112','par113','par114','par115','par116',...
'par117');

inputs.ivpsol.rtol             = 1e-6;
inputs.ivpsol.atol             = 1e-6;

inputs.model.eqns=char(...
'rho = 141.4710605',...
'vol_1 = 0.9',...
'vol_2 = 0.1',...
'rss6 = 2413.6562849217303*vol_1*1.0/vol_2',...
'rss7 = 603.414071180172',...
'rss8 = 40133.38664791273*vol_1*1.0/vol_2',...
'rss9 = 74836.04665510054*vol_1*1.0/vol_2',...
'rss10 = 180754.26889005644*vol_1*1.0/vol_2',...
'rss11 = 164390.2745505474',...
'rss12 = 36512.902220891134',...
'rss13 = 166803.93083553354',...
'rss14 = 39529.972576829896',...
'rss15 = 1810.242213701644',...
'rss16 = 127877.37232994902',...
'rss17 = 166200.51676427448',...
'rss18 = 216060.34296802033*vol_1*1.0/vol_2',...
'rss19 = 5.028450593613567',...
'rss20 = 35306.0740779408*vol_1*1.0/vol_2',...
'rss21 = 0.0*vol_1*1.0/vol_2',...
'rss22 = 532531.1670427525',...
'rss23 = 38926.55850561767',...
'rss24 = 40133.38664808034',...
'rss25 = 689982.1797742102',...
'rss26 = 495414.85075147304*vol_1*1.0/vol_2',...
'rss27 = 2413.6562849329107',...
'rss28 = 83401.9654177705',...
'rss29 = 603.4140712332287',...
'rss30 = 603.4140712332287',...
'rss31 = 2413.656284931604',...
'rss32 = 533134.5811139438',...
'css1=100000',...
'css2=1',...
'css3=1000',...
'css4=1000',...
'css5=30',...
'css6=1000',...
'css7=1000',...
'css8=1000',...
'css9=1000',...
'css10=1000',...
'css11=1000',...
'css12=1000',...
'css13=3000',...
'css14=1000',...
'css15=1000',...
'css16=1000',...
'css17=100',...
'css18=100',...
'css19=100',...
'css20=100',...
'css21=1000',...
'css22=1000',...
'css23=1000',...
'css24=1000',...
'css25=1000',...
'css26=1000',...
'css27=1000',...
'css28=1000',...
'css29=1000',...
'css30=3000',...
'css31=100000',...
'css32=1000',...
'css33=1000',...
'css34=1000',...
'e1=par1',...
'e2=par2',...
'e3=par3',...
'e4=par4',...
'e5=par5',...
'e6=par6',...
'e7=par7',...
'e8=par8',...
'e14=par9',...
'e15=par10',...
'e16 = -par11',...
'e17 = -par12',...
'e18=par13',...
'e19=par14',...
'e20 = -par15',...
'e21 = -par16',...
'e22=par17',...
'e23=par18',...
'e24 = -par19',...
'e25 = -par20',...
'e26=par21',...
'e27=par22',...
'e28=par23',...
'e29 = -par24',...
'e30 = -par25',...
'e31=par26',...
'e32=par27',...
'e33=par28',...
'e34 = -par29',...
'e35 = -par30',...
'e36 = -par31',...
'e37=par32',...
'e38=par33',...
'e39 = -par34',...
'e40 = -par35',...
'e41 = 0.0',...
'e42=par36',...
'e43=par37',...
'e44=par38',...
'e45 = -par39',...
'e46 = -par40',...
'e47=par41',...
'e48 = 0.0',...
'e49 = -par42',...
'e50=par43',...
'e51=par44',...
'e52 = -par45',...
'e53 = -par46',...
'e54=par47',...
'e55 = -par48',...
'e56 = -par49',...
'e57 = -par50',...
'e58=par51',...
'e59=par52',...
'e60=par53',...
'e61 = -par54',...
'e62 = -par55',...
'e63 = -par56',...
'e64=par57',...
'e65 = -par58',...
'e66=par59',...
'e67=par60',...
'e68=par61',...
'e69 = -par62',...
'e70 = -par63',...
'e71 = -par64',...
'e72=par65',...
'e73=par66',...
'e74 = -par67',...
'e75 = -par68',...
'e76=par69',...
'e77 = -par70',...
'e78=par71',...
'e79=par72',...
'e80 = -par73',...
'e81 = -par74',...
'e82=par75',...
'e83=par76',...
'e84=par77',...
'e85=par78',...
'e86=par79',...
'e87 = -par80',...
'e88 = -par81',...
'e89 = -par82',...
'e90 = -par83',...
'e91 = 0.0',...
'e92 = 0.0',...
'e93 = -par84',...
'e94 = 0.7',...
'e95 = -2.0e-1',...
'e96=par85',...
'e97=par86',...
'e98 = -par87',...
'e99 = -par88',...
'e100=par89',...
'e101=par90',...
'e102 = -par91',...
'e103 = -par92',...
'e104=par93',...
'e105=par94',...
'e106 = -par95',...
'e107 = -par96',...
'e108=par97',...
'e109 = -par98',...
'e110=par99',...
'e111=par100',...
'e112=par101',...
'e113 = -par102',...
'e114 = -par103',...
'e115=par104',...
'e116=par105',...
'e117 = -par106',...
'e118=par107',...
'e119 = -par108',...
'e120=par109',...
'e121 = -par110',...
'e122=par111',...
'e123 = -par112',...
'e124=par113',...
'e125 = -par114',...
'e126=par115',...
'e127 = -par116',...
'e128 = -par117',...
'clogk1=log(x1)',...
'clogk2=log(x2)',...
'clogk3=log(x3)',...
'clogk4=log(x4)',...
'clogk5=log(x5)',...
'clogk6=log(x6)',...
'clogk7=log(x7)',...
'clogk8=log(x8)',...
'clogk9=log(x9)',...
'clogk10=log(x10)',...
'clogk11=log(x11)',...
'clogk12=log(x12)',...
'clogk13=log(x13)',...
'clogk14=log(x14)',...
'clogk15=log(x15)',...
'clogk16=log(x16)',...
'clogk17=log(x17)',...
'clogk18=log(x18)',...
'clogk19=log(x19)',...
'clogk20=log(x20)',...
'clogk21=log(x21)',...
'clogk22=log(x22)',...
'clogk23=log(x23)',...
'clogk24=log(x24)',...
'clogk25=log(x25)',...
'clogk26=log(x26)',...
'clogk27=log(x27)',...
'clogk28=log(x28)',...
'clogk29=log(x29)',...
'clogk30=log(x30)',...
'clogk31=log(x31)',...
'clogk32=log(x32)',...
'clogk33=log(x33)',...
'clogk34=log(x34)',...
'r1=0.0',...
'r2=0.0',...
'r3=0.0',...
'r4=0.0',...
'r5=0.0',...
'r6=((rss6*(1.0e0+(((e14*clogk8)+(e15*clogk9))+((e16*clogk6)+(e17*clogk7))))))',...
'r7=((rss7*(1.0e0+(((e18*clogk12)+(e19*clogk13))+((e20*clogk10)+(e21*clogk11))))))',...
'r8=((rss8*(1.0e0+((((e22*clogk15)+(e23*clogk6))+((e24*clogk8)+(e25*clogk14)))+(e26*clogk16)))))',...
'r9=((rss9*(1.0e0+(((e27*clogk16)+(e28*clogk7))+((e29*clogk15)+(e30*clogk9))))))',...
'r10=((rss10*(1.0e0+((((e31*clogk9)+(e32*clogk19))+(e33*clogk20))+(((e34*clogk7)+(e35*clogk17))+(e36*clogk18))))))',...
'r11=((rss11*(1.0e0+((((e37*clogk22)+(e38*clogk11))+((e39*clogk21)+(e40*clogk13)))+(e41*clogk13)))))',...
'r12=((rss12*(1.0e0+(((((((e42*clogk15)+(e43*clogk7))+(e44*clogk21))+((e45*clogk8)+(e46*clogk9)))+(e47*clogk32))+(e48*clogk9))+(e49*clogk30)))))',...
'r13=((rss13*(1.0e0+(((((((e50*clogk25)+(e51*clogk26))+((e52*clogk23)+(e53*clogk24)))+(e54*clogk11))+(e55*clogk11))+(e56*clogk13))+(e57*clogk22)))))',...
'r14=((rss14*(1.0e0+((((((e58*clogk28)+(e59*clogk29))+(e60*clogk23))+(((e61*clogk12)+(e62*clogk27))+(e63*clogk25)))+(e64*clogk27))+(e65*clogk10)))))',...
'r15=((rss15*(1.0e0+((((e66*clogk32)+(e67*clogk22))+(e68*clogk16))+(((e69*clogk15)+(e70*clogk30))+(e71*clogk27))))))',...
'r16=((rss16*(1.0e0+(((e72*clogk21)+(e73*clogk23))+((e74*clogk2)+(e75*clogk25))))))',...
'r17=((rss17*(1.0e0+((e76*clogk24)+(e77*clogk22)))))',...
'r18=((rss18*(1.0e0+(((e78*clogk20)+(e79*clogk17))+((e80*clogk18)+(e81*clogk19))))))',...
'r19=((rss19/(((((((((css24/e1)*(css25/e2))*(css12/e3))*(css33/e4))*(css34/e5))*(css29/e6))*(css10/e7))*(css13/e8))/((((((((1.0e0+(css24/e1))*(1.0e0+(css25/e2)))*(1.0e0+(css12/e3)))*(1.0e0+(css33/e4)))*(1.0e0+(css34/e5)))*(1.0e0+(css29/e6)))*(1.0e0+(css10/e7)))*(1.0e0+(css13/e8)))))*((((((((((x24*css24)/e1)*((x25*css25)/e2))*((x12*css12)/e3))*((x33*css33)/e4))*((x34*css34)/e5))*((x29*css29)/e6))*((x10*css10)/e7))*((x13*css13)/e8))/((((((((1.0e0+((x24*css24)/e1))*(1.0e0+((x25*css25)/e2)))*(1.0e0+((x12*css12)/e3)))*(1.0e0+((x33*css33)/e4)))*(1.0e0+((x34*css34)/e5)))*(1.0e0+((x29*css29)/e6)))*(1.0e0+((x10*css10)/e7)))*(1.0e0+((x13*css13)/e8)))))',...
'r20=((rss20*(1.0e0+(((((((((e82*clogk8)+(e83*clogk7))+(e84*clogk19))+(e85*clogk31))+(e86*clogk32))+((((e87*clogk16)+(e88*clogk9))+(e89*clogk17))+(e90*clogk30)))+(e91*clogk31))+(e92*clogk9))+(e93*clogk15)))))',...
'r21=((rss21*(1.0e0+((e94*clogk18)+(e95*clogk20)))))',...
'r22=((rss22*(1.0e0+(((e96*clogk11)+(e97*clogk30))+((e98*clogk32)+(e99*clogk13))))))',...
'r23=((rss23*(1.0e0+(((e100*clogk8)+(e101*clogk27))+((e102*clogk28)+(e103*clogk16))))))',...
'r24=((rss24*(1.0e0+(((e104*clogk14)+(e105*clogk12))+((e106*clogk29)+(e107*clogk6))))))',...
'r25=((rss25*(1.0e0+((e108*clogk13)+(e109*clogk11)))))',...
'r26=((rss26*(1.0e0+((((e110*clogk32)+(e111*clogk31))+(e112*clogk18))+((e113*clogk30)+(e114*clogk20))))))',...
'r27=((rss27*(1.0e0+(((e115*clogk27)+(e116*clogk31))+(e117*clogk16)))))',...
'r28=((rss28*(1.0e0+((e118*clogk1)+(e119*clogk26)))))',...
'r29=((rss29*(1.0e0+((e120*clogk3)+(e121*clogk33)))))',...
'r30=((rss30*(1.0e0+((e122*clogk4)+(e123*clogk34)))))',...
'r31=((rss31*(1.0e0+((e124*clogk6)+(e125*clogk12)))))',...
'r32=((rss32*(1.0e0+((e126*clogk18)+((e127*clogk31)+(e128*clogk20))))))',...
'dx35=0',... 
'dx1=(r1-r28*1.0e0/rho-x1*css1/x35*dx35)/css1',...
'dx2=(-r2+r16*1.0e0/rho-x2*css2/x35*dx35)/css2',...
'dx3=(r3-r29*1.0e0/rho-x3*css3/x35*dx35)/css3',...
'dx4=(r4-r30*1.0e0/rho-x4*css4/x35*dx35)/css4',...
'dx5=(-r5+r19*1.0e0/rho-x5*css5/x35*dx35)/css5',...
'dx6=(r6-r8+r24*vol_1/vol_2-r31*vol_1/vol_2)/css6',...
'dx7=(r6-r9+r10-2.0e0*r12*vol_1/vol_2-r20)/css7',...
'dx8=(-r6+r8+r12*vol_1/vol_2-r20-r23*vol_1/vol_2)/css8',...
'dx9=(-r6+r9-r10+2.0e0*r12*vol_1/vol_2+r20)/css9',...
'dx10=(r7-120.0e0*r19)/css10',...
'dx11=(r7-r11+1260.0e0*r19-r22+r25)/css11',...
'dx12=(-r7+r14-240.0e0*r19-r24+r31)/css12',...
'dx13=(-r7+r11-1260.0e0*r19+r22-r25)/css13',...
'dx14=(r8-r24*vol_1/vol_2)/css14',...
'dx15=(-r8+r9-r12*vol_1/vol_2+r15*vol_1/vol_2)/css15',...
'dx16=(-r9-r15*vol_1/vol_2+r20+r23*vol_1/vol_2+r27*vol_1/vol_2)/css16',...
'dx17=(2.0e0*r10-2.0e0*r18+2.0e0*r20)/css17',...
'dx18=(4.0e0*r10+6.0e0*r18-r21-3.0e0*r26-r32*vol_1/vol_2)/css18',...
'dx19=(-2.0e0*r10+2.0e0*r18-2.0e0*r20)/css19',...
'dx20=(-4.0e0*r10-6.0e0*r18+r21+3.0e0*r26+r32*vol_1/vol_2)/css20',...
'dx21=(r11-r12-r16)/css21',...
'dx22=(-r11-r15+r17)/css22',...
'dx23=(r13-r14-r16+120.0e0*r19)/css23',...
'dx24=(r13-r17-120.0e0*r19)/css24',...
'dx25=(-r13+r14+r16-120.0e0*r19)/css25',...
'dx26=(-0.5e0*r13+r28)/css26',...
'dx27=(r14+r15-r23-r27)/css27',...
'dx28=(-r14+120.0e0*r19+r23)/css28',...
'dx29=(-r14-120.0e0*r19+r24)/css29',...
'dx30=(r15*vol_1/vol_2+r20-r22*vol_1/vol_2+r26)/css30',...
'dx31=(-r20-r26-r27*vol_1/vol_2+r32*vol_1/vol_2)/css31',...
'dx32=(-r15*vol_1/vol_2-r20+r22*vol_1/vol_2-r26)/css32',...
'dx33=(-120.0e0*r19+r29)/css33',...
'dx34=(-120.0e0*r19+r30)/css34'); 

% steady-state reference concentrations:
      css(1)=100000;
      css(2)=1;
      css(3)=1000;
      css(4)=1000;
      css(5)=30;
      css(6)=1000;
      css(7)=1000;
      css(8)=1000;
      css(9)=1000;
      css(10)=1000;
      css(11)=1000;
      css(12)=1000;
      css(13)=3000;
      css(14)=1000;
      css(15)=1000;
      css(16)=1000;
      css(17)=100;
      css(18)=100;
      css(19)=100;
      css(20)=100;
      css(21)=1000;
      css(22)=1000;
      css(23)=1000;
      css(24)=1000;
      css(25)=1000;
      css(26)=1000;
      css(27)=1000;
      css(28)=1000;
      css(29)=1000;
      css(30)=3000;
      css(31)=100000;
      css(32)=1000;
      css(33)=1000;
      css(34)=1000;


%==================================
% EXPERIMENTAL SCHEME RELATED DATA
%==================================

inputs.exps.n_exp       = 1;                       % Number of experiments     
inputs.exps.exp_y0{1}   = [5,1,5,5,ones(1,30),6];  % Initial conditions for each experiment   
inputs.exps.t_f{1}      = 300;                     % Experiments duration
% inputs.exps.u_interp{1} = 'sustained';             % Stimuli definition for experiment 1.OPTIONS:u_interp: 'sustained' |'step'|'linear'(default)|'pulse-up'|'pulse-down' 
inputs.exps.t_con{1}    = [0 300];                 % Input swithching times: Initial and final time    
% inputs.exps.u{1}        = [1];                     % Values of the inputs 
inputs.exps.n_s{1}      = 12; 
inputs.exps.n_obs{1}    = 13;       
inputs.exps.obs_names{1}= char('y1','y2','y3','y4','y5','y6','y7','y8','y9','y10','y11','y12','y13');
inputs.exps.obs{1}      = char('y1 = x5',...    
                               'y2 = x4',...    
                               'y3 = x3',...    
                               'y4 = x2',...    
                               'y5 = x1',...    
                               'y6 = x29',...    
                               'y7 = x27',...   
                               'y8 = x21',...   
                               'y9 = x15',...   
                               'y10 = x13',...  
                               'y11 = x30',...  
                               'y12 = x32',...
                               'y13 = x11');  
                           
inputs.exps.t_s{1}      = [23.9759 48.4337 72.8916 90.3614 115.984 140.442 164.9 210.321 233.614 258.072 282.53 300];
timeseries_artificalData_noised = [
% Productprotein	L-Methionine	L-Leucine	L-Lactate	beta-D-Glucose	L-Aspartate	L-Malate	Pyruvate	Oxaloacetate	ATP	ATP	ADP	ADP_c
% Time	f	f	f	f	f	c	c	c	m	c	m	m	c
% min	mumol/l_fermenter	mumol/l_fermenter	mumol/l_fermenter	mumol/l_fermenter	mumol/l_fermenter	mumol/l_cell	mumol/l_cell	mumol/l_cell	mumol/l_cell	mumol/l_cell	mumol/l_cell	mumol/l_cell	mumol/l_cell
0	    29.54174187	5110.119691	4999.956639	1.056682831	449958.4343	1009.945764	988.3517969	996.1405443	839.7703035	3314.558385	2968.296835	1016.447754	1029.663149
23.9759	29.06135825	4427.537773	4990.471667	19033.05068	499628.9405	514.889607	1883.981851	4115.730274	443.5222307	3298.082924	3588.716676	701.1769714	841.6656476
48.4337	31.56920926	4649.633023	4706.446115	29713.37459	498137.7445	614.0882509	1999.234422	5088.17481	457.2654501	3144.678363	3524.003949	534.3245626	898.4469128
72.8916	32.58992629	4642.175831	4703.420191	52653.84782	469436.4399	667.144403	1977.174384	4941.17988	452.1008571	3343.981672	3274.933898	637.1604048	748.7508252
90.3614	32.93492455	4581.482695	4580.779761	62491.60793	458816.0559	706.4697945	2027.556359	5561.084132	416.1288178	3305.264733	3377.224218	608.6810043	760.8237877
115.984	33.80995822	4231.998041	4576.568758	71665.49964	441725.8779	748.837145	1834.640732	4711.566421	433.6235068	2664.13707	3359.281519	608.5031107	746.0614226
140.442	34.67192676	4609.073999	4388.444795	93744.69241	371353.6441	761.4219172	1741.34438	4466.968205	471.9681186	3276.842196	3268.007202	609.2855454	770.8013591
164.9	35.64086504	4379.397091	4823.258118	96012.12538	409872.6888	913.9581526	2054.553359	4841.62543	462.4384044	3326.232934	3375.331315	657.6144762	747.1622156
210.321	35.1073701	4047.37735	4757.799632	131633.9417	429309.5792	838.4429003	2023.441102	4741.87247	463.3431076	2838.535673	3344.113884	606.0191858	696.1165299
233.614	34.78766884	4354.532227	4267.505383	139701.0391	377830.4707	864.115653	2012.727053	4982.305375	451.6411544	3445.146289	3384.49464	596.595147	747.4997328
258.072	35.10275329	3893.078648	3946.812817	156106.4324	376607.9654	1019.41341	2077.935601	4932.876021	432.2633547	3185.845081	3123.317817	606.9552722	742.2563724
282.53	39.16229127	4223.934695	4229.786474	189350.8377	350136.0051	945.7524046	2018.02482	4965.805674	459.569613	3248.126308	3303.223152	634.2843344	740.5121927
300	39.36873083	3819.952372	3226.591797	170253.9838	362466.0386	962.815767	2167.954632	4922.316021	461.1326466	3189.167366	3335.671338	664.509921	757.3732437];

unscaled_data     = timeseries_artificalData_noised(2:end,2:end);
scaled_data       = unscaled_data;
scaled_data(:,1)  = unscaled_data(:,1)/css(5);
scaled_data(:,2)  = unscaled_data(:,2)/css(4);
scaled_data(:,3)  = unscaled_data(:,3)/css(3);
scaled_data(:,4)  = unscaled_data(:,4)/css(2);
scaled_data(:,5)  = unscaled_data(:,5)/css(1);
scaled_data(:,6)  = unscaled_data(:,6)/css(29);
scaled_data(:,7)  = unscaled_data(:,7)/css(27);
scaled_data(:,8)  = unscaled_data(:,8)/css(21);
scaled_data(:,9)  = unscaled_data(:,9)/css(15);
scaled_data(:,10) = unscaled_data(:,10)/css(13);
scaled_data(:,11) = unscaled_data(:,11)/css(30);
scaled_data(:,12) = unscaled_data(:,12)/css(32);
scaled_data(:,13) = unscaled_data(:,13)/css(11);
inputs.exps.exp_data{1}   = scaled_data;  

timeseries_artificalData_stdev = [
0	    0.916516259	220.2393825	0.086722941	0.113365662	100083.1314	19.8915281	23.29640617	7.718911471	320.4593929	629.11677	63.40633065	32.89550786	59.32629796
23.9759	3.42708349	859.4844544	266.3833335	524.0986472	27089.88103	72.52278599	1.363702921	13.17945154	67.9675385	110.2258472	512.6933529	67.11194286	169.2792952
48.4337	0.072781474	197.1939541	83.56777088	13530.25082	50101.48902	8.871498249	109.6688443	1402.38962	25.79309975	208.3432738	361.1878982	244.5448747	294.6078256
72.8916	0.345652583	11.22833874	111.2603823	145.6956478	17694.8798	11.00519392	1.408768357	800.1597591	29.84428584	184.2633444	149.0122046	26.80319038	1.191650429
90.3614	0.103150906	5.585389682	4.179521469	2222.584132	13862.11186	0.953588928	72.01271842	1881.128264	99.10036436	104.3694651	49.86843658	78.08799131	27.79957543
115.984	0.003516434	495.8039179	193.3375168	15030.00072	4663.755834	0.759709907	343.8585363	3.332842875	61.44498639	1179.74586	8.403037386	72.83977854	0.150845275
140.442	0.186053515	442.6879971	1.429589001	515.5848117	112764.7117	48.67616557	548.4312396	616.2835899	16.98823721	45.18439211	177.4455966	67.99290924	50.07871826
164.9	0.604730081	164.3741824	1052.096236	22589.74924	12874.62245	190.2563052	67.32671764	29.79086077	0.791191271	144.5058684	35.34263088	30.52495245	2.300431195
210.321	3.228859795	170.8252992	1250.019264	372.1165486	67335.15833	70.03419938	0.977796603	311.3950597	2.654215273	828.1886549	27.87223266	71.86362837	102.5249403
233.614	5.262062329	608.8844539	434.830766	8311.921766	14941.05855	69.51269399	20.40589406	115.4107506	20.1576913	387.132577	53.48928055	91.2997059	1.854534475
258.072	6.079093429	142.482705	35.01436682	49.13512714	3973.930766	190.684819	114.9912025	29.80795876	58.42129056	128.8298377	467.6643662	71.7674556	14.94525519
282.53	0.608382544	688.7293909	700.4329474	42607.67548	27959.98971	4.487190854	2.669639537	1.328651269	3.420773959	1.32738423	106.1736951	18.79533114	21.39761464
300	    0.008461654	0.624744428	1186.096406	12180.03246	11498.07728	3.204466046	309.209264	110.2279582	0.074706795	116.9052678	39.83732302	40.18584194	10.01248736];

unscaled_error    = timeseries_artificalData_stdev(2:end,2:end);
scaled_error      = unscaled_error;
scaled_error(:,1)  = unscaled_error(:,1)/css(5);
scaled_error(:,2)  = unscaled_error(:,2)/css(4);
scaled_error(:,3)  = unscaled_error(:,3)/css(3);
scaled_error(:,4)  = unscaled_error(:,4)/css(2);
scaled_error(:,5)  = unscaled_error(:,5)/css(1);
scaled_error(:,6)  = unscaled_error(:,6)/css(29);
scaled_error(:,7)  = unscaled_error(:,7)/css(27);
scaled_error(:,8)  = unscaled_error(:,8)/css(21);
scaled_error(:,9)  = unscaled_error(:,9)/css(15);
scaled_error(:,10) = unscaled_error(:,10)/css(13);
scaled_error(:,11) = unscaled_error(:,11)/css(30);
scaled_error(:,12) = unscaled_error(:,12)/css(32);
scaled_error(:,13) = unscaled_error(:,13)/css(11);
inputs.exps.error_data{1} = scaled_error;

inputs.exps.data_type   = 'real';
inputs.exps.noise_type  = 'homo_var'; 

%==================================
% UNKNOWNS RELATED DATA
%==================================

load b4_bounds.mat
inputs.model.par = x0;

% Parameter bounds and initial guess:
inputs.PEsol.id_global_theta    = 'all'; 
inputs.PEsol.global_theta_min   = lb; 
inputs.PEsol.global_theta_max   = ub;   
inputs.PEsol.global_theta_guess = x0;

% Cost function type:
inputs.PEsol.PEcost_type        = 'llk'; 
inputs.PEsol.PEcostJac_type     = 'llk';
inputs.PEsol.llk_type           = 'hetero'; 

%=======================================
% OPTIMIZATION settings
%=======================================

inputs.nlpsol.nlpsolver   = 'ess';
inputs.nlpsol.eSS.maxeval = 1.6e5;
inputs.nlpsol.eSS.maxtime = 3600;
% inputs.nlpsol.eSS.log_var = 1:(size(inputs.PEsol.global_theta_guess,2)); % set log exploration to all or selected vars
inputs.nlpsol.eSS.local.solver = 'nl2sol';
inputs.nlpsol.eSS.local.finish = 'nl2sol';

